$breakpoint-quote: 1600px;
$quoteMobileSidePadding: 20px;

@mixin WrapTextCharacter($left, $right) {
  p {
    &::before {
      content: $left;
    }
    &::after {
      content: $right;
    }
  }
}
@mixin MinimalistAuthorBox(
  $gradientLeftColor,
  $gradientRightColor,
  $hasDescription: false
) {
  .author-box {
    user-select: none;
    flex-direction: row;
    align-items: center;
    background: linear-gradient(
      to right,
      $gradientLeftColor 0%,
      $gradientRightColor 100%
    );
    border-radius: 6px;
    width: 300px;

    .name {
      padding: 10px 25px 10px 5px;
      @if $hasDescription {
        padding-bottom: 0px;
      }
    }
    .description {
      display: none;
    }
    @if $hasDescription {
      .description {
        display: block;
        padding-bottom: 10px;
        margin-left: 4px;
        margin-right: 10px;
      }
    }
    .image {
      width: 80px;
      height: 80px;
      margin: 0;
      border: none;
      box-shadow: none;
    }
  }
}

@mixin recolorQuote(
  $color-text,
  $color-border,
  $color-background,
  $color-highlight,
  $color-description
) {
  .simple-container.quote-box {
    border-color: $color-border;
    background-color: $color-background;
    p,
    li {
      color: $color-text;
    }
    code,
    span.line > span {
      color: $color-highlight;
    }
    a {
      color: $color-highlight;
      &::before {
        background-color: rgba($color-highlight, 0.2);
      }
      &:hover,
      &:focus {
        background-color: $color-highlight;
        color: $color-background;
      }
    }
  }
  .author-box {
    .image {
      border-color: $color-border;
    }
    .text {
      .name {
        color: $color-text;
      }
      .description {
        color: $color-description;
      }
    }
  }
}

@mixin whiteBGQuote($opacity: 0.3) {
  .simple-container.quote-box::after {
    background: url("/images/patterns/white-crisscross-pattern.svg");
    opacity: $opacity;
    background-size: 150px;
  }
}

// THEMES
.quote-content-row
  .full-width-wrapper-inner
  .quote-container {
  // Color themes
  &.aqua {
    @include recolorQuote(
      $color-sunset-aqua,
      darken($color-sunset-melancholic, 15%),
      darken($color-sunset-melancholic, 45%),
      white,
      $color-sunset-melancholic
    );
    @include whiteBGQuote();
  }
  &.secret {
    @include recolorQuote(
      $color-spooky-secondary,
      darken($color-spooky, 15%),
      darken($color-spooky, 45%),
      white,
      $color-spooky
    );
    @include whiteBGQuote();
  }
  &.sanguine {
    $red: #ff442b;
    @include recolorQuote(
      #ff6923,
      #ff6923,
      darken($red, 45%),
      #ffc21c,
      $red
    );
    .author-box .image {
      background-size: 150%;
      background-position-x: 70%;
      background-position-y: 10%;
    }
  }
  &.cobalt-color {
    $cobalt: #6399fd;
    @include recolorQuote(
      lighten($cobalt, 20%),
      darken($cobalt, 05%),
      darken($cobalt, 50%),
      #1cb7ff,
      $cobalt
    );
    @include whiteBGQuote();
  }
  &.cobalt {
    .author-box .image {
      background-size: 150%;
      background-position-x: 0%;
      background-position-y: 80%;
    }
  }

  // Themes for specific characters
  &.uniserve {
    .author-box .image {
      background-size: 120%;
      background-position-x: 20%;
      background-position-y: 80%;
    }
  }
  &.machine-end-of-time {
    .quote-box {
      text-transform: uppercase;
    }
  }

  // RYUJIN & TOSHI
  &.ryujin {
    .quote-box p {
      &::before {
        content: "[ ";
      }
      &::after {
        content: " ]";
      }
    }
  }
  &.toshi {
    .quote-box p {
      text-transform: uppercase;
      &::before {
        content: "« ";
      }
      &::after {
        content: " »";
      }
    }
  }

  // AENEAS & GRUZ
  $aeneas: #d68e08;
  &.aeneas-color {
    @include recolorQuote(
      lighten($aeneas, 20%),
      lighten($aeneas, 20%),
      #381f02,
      #ffebab,
      #e6a429
    );
    @include whiteBGQuote();
  }
  &.aeneas {
    @include MinimalistAuthorBox(#421a083d, #472b06, true);
    .quote-box p {
      text-transform: uppercase;
      &::before {
        content: "▒ ";
      }
      &::after {
        content: " ▒";
      }
    }
  }
  $gruz: #cac418;
  $gruzHighlight: #fdee20;
  &.gruz-color {
    @include recolorQuote(
      lighten($gruzHighlight, 10%),
      lighten($gruzHighlight, 10%),
      darken($gruz, 35%),
      white,
      $gruz
    );
    @include whiteBGQuote();
  }
  &.gruz {
    @include MinimalistAuthorBox(#50430a3d, #333209, true);
    .quote-box p {
      &::before {
        content: "❮ ";
      }
      &::after {
        content: " ❯";
      }
    }
  }

  $fiftyone: #ff9813;
  $fiftyoneHighlight: #e64b0e;
  &.fiftyone-color {
    @include recolorQuote(
      lighten($fiftyone, 5%),
      lighten($fiftyone, 5%),
      darken($fiftyoneHighlight, 39%),
      white,
      $fiftyoneHighlight
    );
    // @include whiteBGQuote();
  }
  &.fiftyone {
    @include MinimalistAuthorBox(
      #3f190457,
      #502408e3,
      true
    );
    @include WrapTextCharacter(":: ", " ::");
  }

  &.uniserve-strip {
    @include MinimalistAuthorBox(
      #04273f57,
      #033744d0,
      true
    );
  }

  // Shattered
  &.crawler-pilot {
    @include WrapTextCharacter("❯ ", "");
    .quote-box p {
      text-transform: uppercase;
    }
  }
  &.crawler-navigator {
    @include WrapTextCharacter("░ ", " ░");
  }
  &.crawler-pilot,
  &.crawler-navigator {
    @include MinimalistAuthorBox(
      #470f015d,
      #632501d0,
      true
    );
  }
  $lisa: #0ef1ff;
  $lisaHighlight: #0ebbff;
  &.lisa {
    @include MinimalistAuthorBox(
      #07d1f533,
      #01335c5b,
      true
    );
    @include recolorQuote(
      lighten($lisa, 25%),
      lighten($lisa, 5%),
      darken($lisaHighlight, 43%),
      white,
      $lisaHighlight
    );
    @include whiteBGQuote();
    .quote-box p {
      text-shadow: 3px 0px 2px #0f8bc4a2,
        7px 0px 2px #1773eb7a;
    }
  }

  &.dot {
    @include MinimalistAuthorBox(
      #33154479,
      #332452ee,
      true
    );
    @include recolorQuote(
      #bb8fec,
      #9171da,
      #241f31,
      white,
      #9171da
    );
    @include WrapTextCharacter("", " ¶");
    @include whiteBGQuote(0.2);
  }
  &.insist {
    @include MinimalistAuthorBox(#30303081, #444444, true);
    @include recolorQuote(
      #cccccc,
      #cccccc,
      #303030,
      white,
      #cccccc
    );
    @include WrapTextCharacter("> ", "");
    @include whiteBGQuote(0.3);
  }

  // RADIUS AND THE SILENCES
  &.silence {
    //᠁
    .quote-box {
      padding: 5px 30px;
      @include WrapTextCharacter("〈 ", " 〉");
    }
    @include MinimalistAuthorBox(
      rgba(187, 42, 16, 0.05),
      rgba(187, 42, 16, 0.2)
    );

    &.center {
      @include WrapTextCharacter("⦑ ", " ⦒");
    }
    &.globe {
      @include WrapTextCharacter("《 ", " 》");
    }
  }

  &.akula {
    $color-akula: #c22de0;
    @include recolorQuote(
      lighten($color-akula, 20%),
      darken($color-akula, 05%),
      darken($color-akula, 40%),
      $color-akula,
      $color-akula
    );
    @include MinimalistAuthorBox(#30113f42, #c22de042);
    @include whiteBGQuote();
  }
}

// MAIN STYLING
.quote-content-row {
  font-variant-ligatures: none; // Because fi was turning into a single character?
  astro-slot,
  .simple-container-inner {
    white-space: pre-wrap;
    font-size: 16px;
    @include codeText();
    p,
    li,
    span {
      @include codeText();
    }
    p {
      margin-top: 20px;
      margin-bottom: 20px;
      width: 100%;
      line-height: 28px;
    }
    p.perfect {
      font-family: monospace;
    }
    ul {
      padding-left: 15px;
    }
    ol {
      padding-left: 30px;
    }
    li {
      margin-top: -10px;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-family: $font-code;
      color: $color-sunset-red;
      //background-color: rgba($color-background-dark, 0.4);
      font-weight: 600;
      margin-top: 40px;
      margin-bottom: 30px;
      line-height: 38px;
      padding: 10px 3px 2px 3px;
      display: inline-block;
      &::before {
        //content: "# ";
      }
      i {
        display: none;
      }
    }
    code {
      color: $color-sunset-red;
      background-color: rgba($color-background-dark, 0.4);
      padding: 0px 3px 2px;
    }
    hr {
      border-color: $color-sunset-red;
      margin: 60px 0;
    }
    a {
      @include BasicLinkStyle();
    }
  }

  .full-width-wrapper-inner {
    display: flex;
    justify-content: flex-end;
    @media screen and (max-width: $breakpoint-quote) {
      justify-content: flex-start;
      margin-left: $quoteMobileSidePadding;
      margin-right: $quoteMobileSidePadding;
    }

    .quote-container {
      display: inline-block;
      position: relative;
      @include standardBoxShadow;
      .author-box {
        width: 250px;
        position: absolute;
        left: calc(100% + 10px);
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
        @media screen and (max-width: $breakpoint-quote) {
          position: relative;
          left: auto;
          width: auto;

          flex-direction: row;
          align-items: flex-end;
          margin-bottom: 10px;
        }
        $imageHeight: 130px;
        $imageWidth: 200px;
        $mobileShrink: 0.7;
        .image {
          max-width: 200px;
          height: $imageHeight;
          width: $imageWidth;
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
          border: $size-line-width solid $color-sunset-red;
          border-radius: $chicanery-border-radius;
          margin-bottom: 10px;
          flex-shrink: 0;
          box-shadow: inset 0 0 15px rgba(black, 0.5);
          @media screen and (max-width: $breakpoint-quote) {
            margin: 0 10px 0 0;
            width: $imageWidth * $mobileShrink;
            height: $imageHeight * $mobileShrink;
          }

          &.trash-can-overlay {
            position: relative;

            &::before {
              content: "";
              position: absolute;
              top: 0;
              bottom: 0;
              left: 0;
              right: 0;
              background: linear-gradient(
                to bottom,
                $color-sunset-orange,
                $color-sunset-red
              );
              opacity: 0.9;
              mix-blend-mode: color;
            }
            &::after {
              content: "";
              position: absolute;
              top: 0;
              bottom: 0;
              left: 0;
              right: 0;
              background: linear-gradient(
                to bottom,
                $color-sunset-orange,
                #ff8100
              );
              opacity: 0.3;
              mix-blend-mode: hard-light;
            }
          }
        }
        .text {
          display: flex;
          flex-direction: column;
          .name {
            display: inline-block;
            font-family: $font-title;
            font-weight: 600;
            font-size: 24px;
            line-height: 32px;
            text-align: left;
            color: $color-sunset-orange;
            white-space: nowrap;
            @media screen and (max-width: $breakpoint-quote) {
              text-align: left;
            }

            text-decoration: none;
            &:hover,
            &:focus {
              color: white !important;
              background-color: rgba(white, 0.1);
            }
          }
          .description {
            margin-top: 2px;
            text-align: left;
            color: $color-sunset-red;
            font-family: $font-code;
            font-size: 15px;
            line-height: 20px;

            font-weight: 500;
            //letter-spacing: -0.5px;
            @media screen and (max-width: $breakpoint-quote) {
              margin-top: 4px;
              font-size: 12px;
            }
          }
        }

        .blinkbox-container {
          position: relative;
          margin-bottom: 10px;
          max-width: 200px;
          height: 150px;
          width: 100%;

          display: flex;
          justify-content: center;
          align-items: center;
          border: 2px solid $color-sunset-red;
          border-radius: $chicanery-border-radius;
          background: linear-gradient(
            to bottom,
            rgba($color-sunset-red, 0.05),
            rgba($color-sunset-red, 0.2)
          );

          @media screen and (max-width: $breakpoint-quote) {
            margin-bottom: 0;
            margin-right: 10px;

            max-width: 120px;
            height: 90px;
          }

          .blinking-grid {
            margin: 1.5px;
            height: 50px;
            width: 50px;
          }
          .floater {
            position: absolute;
            top: 10px;
            color: $color-sunset-red;
            @media screen and (max-width: $breakpoint-quote) {
              //display: none;
              transform: rotate(180deg);
              top: auto;
              left: 10px;
              writing-mode: vertical-lr;
            }
          }
          .floater-under {
            position: absolute;
            bottom: 10px;
            color: $color-sunset-orange;
            @media screen and (max-width: $breakpoint-quote) {
              bottom: auto;
              right: 10px;
              writing-mode: vertical-lr;
            }
          }
        }
      }
      .quote-box {
        padding: 20px 30px;
        @media screen and (max-width: $breakpoint-mobile) {
          padding: 10px 25px;
        }
      }

      // quote is a trash can transcription, collapsible
      &.transcription {
        .transcription-open {
          padding: 20px;
          margin: 20px;
          max-width: 100%;

          background: none;
          border: 2px solid transparent;

          text-align: center;
          font-family: $font-code;
          color: $color-sunset-orange;
          border-radius: $chicanery-border-radius;
          font-size: 16px;
          cursor: pointer;

          &:hover,
          &:focus {
            border-color: $color-sunset-orange;
            background: rgba($color-sunset-red, 0.2);
          }

          @media screen and (max-width: $breakpoint-mobile) {
            padding: 5px;
            margin: 10px;
          }
        }
        astro-slot {
          display: none;
        }

        &.open {
          .transcription-open {
            display: none;
          }
          astro-slot {
            display: block;
          }
        }
      }
    }
  }

  &.left {
    .full-width-wrapper-inner {
      justify-content: flex-start;
      .author-box {
        left: auto;
        right: calc(100% + 10px);
        justify-content: flex-end;
        align-items: flex-end;

        @media screen and (max-width: $breakpoint-quote) {
          right: auto;
          justify-content: flex-start;
        }

        .text {
          width: 90%;
          @media screen and (max-width: $breakpoint-quote) {
            width: auto;
          }
        }
      }
    }
  }

  &.no-image {
    .author-box {
      //margin: 10px;
      @media screen and (max-width: $breakpoint-quote) {
        //margin: 0;
      }
    }
  }

  button.user-choice {
    border: 2px solid $color-sunset-aqua;
    background: none;
    color: $color-sunset-aqua;
    background: rgba($color-sunset-melancholic, 0.2);
    border-radius: $chicanery-border-radius;
    margin: 20px 10px;
    padding: 10px;

    font-family: $font-code;
    font-weight: 600;
    cursor: pointer;

    &:hover,
    &:focus {
      color: white;
      border-color: white;
    }
  }
}
