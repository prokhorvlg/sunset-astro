---
export const prerender = true;

import { FullImageDetails } from '@/components/common/ImageGallery/ImageGallery.component';
import { ImageDetails, ImageId, Images } from '@/data/sharedImages';
import { getImage } from '@astrojs/image';
import ImageContentRow from './ImageContentRow.component'

interface Props {
  direction?: "vertical" | "horizontal"
  images: ImageId[];
  noCap?: boolean
}

const CRUNCH_WIDTH = 1300

const imagesProcessed = await Promise.all(Astro.props.images.map(async (image) => {
  // Find relevant image object
  const imageObject = Images.find((imageItem) => imageItem.id === image)
  if (!imageObject) return null

  // Check if image is smaller than crunch size
  const isSmall = imageObject.width < CRUNCH_WIDTH

  // Generate an image of the correct size
  return {
    originalObject: imageObject,
    processedObject: await getImage({
      src: imageObject.src,
      alt: imageObject.alt || "",
      aspectRatio: `${imageObject.width}:${imageObject.height}`,
      width: isSmall ? imageObject.width : CRUNCH_WIDTH,
      format: imageObject.format ? imageObject.format as any : "webp",
      quality: 99
    })
  } as FullImageDetails
}))
---

<ImageContentRow 
  client:only="react"
  imageItems={imagesProcessed} 
  noCap={Astro.props.noCap}
/>